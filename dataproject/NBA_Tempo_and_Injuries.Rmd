---
title: "NBA Tempo & Injuries: Analyzing the Effects on Performance and Winnings"
subtitle: "COOP Data Analytics Data Project"
author: "Reina Li, Christian Uriostegui, Ao Kong, Kaiden Vega"
output:
  github_document:
    toc: true
---

--------------------------------------------------------------------------------

![](nbalogo.PNG?raw=true)

# **Introduction**

## Background

In the NBA, team organizations have suffered tremendously due to injuries. Some injuries have even cost championships. However, games aren't the only thing that teams lose; organizations also lose money by paying out contracts to players who are unable to play due to injuries.

![](nbahurt1.PNG?raw=true) ![](nbahurt2.PNG?raw=true)

-----

## Purpose

![](nbacommissioner.PNG?raw=true)

**Client**: Adam Silver, Commissioner of the National Basketball Association (2014-present)

- Identify trends of different game statistics:
  - pace
  - possessions
  - speed
  - distance
  - number of games missed due to injuries
  - number of injured players
  - cash earned while injured
  - playstyles
- explore patterns/relationships between tempo, injuries, and winnings
- provide recommendations on how the NBA can reduce injuries overall and save money on injured players' contracts

----------

# **Data Set**

## Dataset

- 30 NBA teams
- playstyles (seasons 2015-16 to 2021-21)
- speed and distance (seasons 2013-14 to 2020-21)
- pace and possessions (seasons 1996-97 to 2020-21)
- injuries and money earned while injured (seasons 2016-17 to 2021-21)
- season performance

-----

## Pace and Possession

- **pace** = (possessions/minutes) * 40
- **possession** : the action of a player getting the ball and the play ends in a field goal/free throw made, opponent rebound, or a turnover

- examine trends between pace and possession over time
- find a potential correlation between pace and possession

-----

## Injuries

- teams with highest injuries
- financial losses due to injuries (league paying injured players with a contract who do not play)
- examine a potential correlation between tempo and injuries

-----

## Performance

- examine the performance of teams that have made it to the playoff finals within our time frame
- find out if there is a correlation between:
  - tempo and performance
  - injuries and performance

----------

# **Analysis**

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Libraries---------------------------------------------------------------------
library(tidyverse)
library(janitor)
library(lubridate)
library(readxl)
library(CGPfunctions)
library(directlabels)
library(scales)
library(GGally)
library(psych)
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Functions---------------------------------------------------------------------
# Make a function that imports all the sheets from the Excel file
read_excel_allsheets <- function(filename, tibble = FALSE) {
  sheets <- readxl::excel_sheets(filename)
  x <- lapply(sheets, function(X) readxl::read_excel(filename, sheet = X))
  if(!tibble) x <- lapply(x, as.data.frame)
  names(x) <- sheets
  x
}
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Get the data------------------------------------------------------------------
# Pace data set
pace <- read_excel("pace.xlsx")
pace_long <- read_excel("pace_long.xlsx")

# Possessions data set
poss <- read_excel("poss.xlsx")
poss_long <- read_excel("poss_long.xlsx")

# Change column names of Teams because they contain spaces
colnames(pace) <- c("Season", "Atlanta_Hawks", "Boston_Celtics", "Brooklyn_Nets", 
                    "Charlotte_Hornets", "Chicago_Bulls", "Cleveland_Cavaliers", 
                    "Dallas_Mavericks", "Denver_Nuggets", "Detroit_Pistons", 
                    "Golden_State_Warriors", "Houston_Rockets", "Indiana_Pacers", 
                    "Los_Angeles_Clippers", "Los_Angeles_Lakers", "Memphis_Grizzlies", 
                    "Miami_Heat", "Milwaukee_Bucks", "Minnesota_Timberwolves", 
                    "New_Orleans_Pelicans", "New_York_Knicks", "Oklahoma_City_Thunder", 
                    "Orlando_Magic", "Philadephia_76ers", "Phoenix_Suns", 
                    "Portland_Trail_Blazers", "Sacramento_Kings", 
                    "San_Antonio_Spurs", "Toronto_Raptors", "Utah_Jazz", 
                    "Washington_Wizards", "Season_Average")
colnames(poss) <- c("Season", "Atlanta_Hawks", "Boston_Celtics", "Brooklyn_Nets", 
                    "Charlotte_Hornets", "Chicago_Bulls", "Cleveland_Cavaliers", 
                    "Dallas_Mavericks", "Denver_Nuggets", "Detroit_Pistons", 
                    "Golden_State_Warriors", "Houston_Rockets", "Indiana_Pacers", 
                    "Los_Angeles_Clippers", "Los_Angeles_Lakers", "Memphis_Grizzlies", 
                    "Miami_Heat", "Milwaukee_Bucks", "Minnesota_Timberwolves", 
                    "New_Orleans_Pelicans", "New_York_Knicks", "Oklahoma_City_Thunder", 
                    "Orlando_Magic", "Philadephia_76ers", "Phoenix_Suns", 
                    "Portland_Trail_Blazers", "Sacramento_Kings", 
                    "San_Antonio_Spurs", "Toronto_Raptors", "Utah_Jazz", 
                    "Washington_Wizards", "Season_Average")
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Initial manipulation and joining----------------------------------------------
# Change Season from pace_long to character
pace_long$Season <- as.character(pace_long$Season)
poss_long$Season <- as.character(poss_long$Season)

# Initial manipulation
pace_long_change <- pace_long %>%
  filter(Season == 1996 | Season == 2020)

poss_long_2018 <- poss_long %>%
  filter(Season == 1996 | Season == 2018)

# Save pace data without season average
pace_long1 <- pace_long %>%
  filter(Team != "Season Average")

# Save pace data with only season average
pace_long2 <- pace_long %>%
  filter(Team == "Season Average")

# Create data frame to print season average on each facet
average_Pace <- data.frame(
  variable = unique(pace_long2$Season),
  value = pace_long2$Pace,
  Team = rep(unique(pace_long1$Team), each = 25))
average_pace_teams <- pace_long1 %>%
  group_by(Team) %>%
  arrange(Team) %>%
  mutate(team_avg = mean(Pace, na.rm = TRUE)) %>%
  ungroup()

# Save possession data without season average
poss_long1 <- poss_long %>%
  filter(Team != "Season Average")

# Save possession data with only season average
poss_long2 <- poss_long %>%
  filter(Team == "Season Average")

# Create data frame to print season average on each facet
average_Poss <- data.frame(
  variable = unique(poss_long2$Season),
  value = poss_long2$Possessions,
  Team = rep(unique(poss_long1$Team), each = 25))
average_poss_teams <- poss_long1 %>%
  group_by(Team) %>%
  arrange(Team) %>%
  mutate(team_avg = mean(Possessions, na.rm = TRUE)) %>%
  ungroup()
```

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(pace_long1, aes(x = Season, y = Pace, group = Team, color = Team)) + 
  geom_line(linetype = "dashed") + 
  geom_line(data = pace_long2, color = "black") + 
  geom_point(data = pace_long2, color = "black") + 
  theme_light() + 
  labs(title = "NBA Seasons 1996-97 to 2020-21 Pace By Teams",
       x = "Season",
       y = "Pace") +
  theme(legend.position = "bottom")
```

The pace by teams is visualized above. Each of the colored dashed lines represents the pace for each team for seasons 1996-97 to 2020-21. The black solid line represents the average pace of all teams for each season.

From the visualization, we see an increase in pace for NBA team over time.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
newggslopegraph(dataframe = pace_long_change,
                Times = Season,
                Measurement = Pace,
                Grouping = Team,
                Title = "NBA Team Pace Evolution",
                SubTitle = "Seasons 1996-97 to 2020-21",
                Caption = NULL)
```

To further support the previous visualization, the evolution of team pace from seasons 1996 to 2020 is visualized above. As mentioned earlier, we see an increase in pace for NBA team over time.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(pace_long1, aes(x = Season, y = Pace, group = Team, color = Team)) + 
  geom_line() + 
  #geom_line(data = pace_long2, color = "black") + 
  #geom_point(data = pace_long2, color = "black") + 
  facet_wrap(~Team) + 
  geom_line(data = average_Pace, aes(x = variable, y = value), color = "black", linetype = "dashed") + 
  geom_line(data = average_pace_teams, aes(x = Season, y = team_avg), color = "black") + 
  theme_light() + 
  labs(title = "NBA Seasons 1996-97 to 2020-21 Pace By Teams",
       x = "Season",
       y = "Pace") + 
  theme(legend.position = "none")
```

Let's take a closer look at the pace by teams. Each of the colored dashed lines is the pace for each team over the years. The dashed black line represents the average pace for each season, and is the same in each facet. The solid black line represents the average pace for each team, and is different in each facet.

From the visualization, we can see that every team has seen an increase in pace. Also, all teams in the 2020 season have a pace greater than their team average pace.

-----

## Key Notes: Pace

- a steady increase in the league over time
- apparent in every single NBA team
- all teams in the 2020 season have a pace greater than their team average pace

-----

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(poss_long1, aes(x = Season, y = Possessions, group = Team, color = Team)) + 
  geom_line(linetype = "dashed") + 
  geom_line(data = poss_long2, color = "black") + 
  geom_point(data = poss_long2, color = "black") + 
  theme_light() + 
  labs(title = "NBA Seasons 1996-97 to 2020-21 Possessions By Teams",
       x = "Season",
       y = "Possessions") +
  theme(legend.position = "bottom")
```

The possessions by teams is visualized above. Each of the colored dashed lines represents the possessions for each team for seasons 1996-97 to 2020-21. The black solid line represents the average possessions of all teams for each season.

From the visualization, we see two big dips in 1998 and 2011. The reason for the dips in 1998 and 2011 is because the games were cut short due to boycotts and negotiations for contracts. We also observe lower possessions for 2019 and 2020. That may be due to COVID-19, since they played less games. Without the big drops in 1998 and 2011, and in 2019 and 2020, we can see a small increase in possessions.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
newggslopegraph(dataframe = poss_long_2018,
                Times = Season,
                Measurement = Possessions,
                Grouping = Team,
                Title = "NBA Team Possessions Evolution",
                SubTitle = "Seasons 1996-97 to 2020-21",
                Caption = NULL)
```

In this visualization, we see the evolution of possessions from seasons 1996 to 2018. We didn't include 2019 and 2020 in this visualization because there were decreases due to fewer games played due to COVID-19. As mentioned earlier, we see an overall increase in possessions for NBA teams.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(poss_long1, aes(x = Season, y = Possessions, group = Team, color = Team)) + 
  geom_line() + 
  facet_wrap(~Team) + 
  geom_line(data = average_Poss, aes(x = variable, y = value), color = "black", linetype = "dashed") + 
  geom_line(data = average_poss_teams, aes(x = Season, y = team_avg), color = "black") + 
  theme_light() + 
  labs(title = "NBA Seasons 1996-97 to 2020-21 Possessions By Teams",
       x = "Season",
       y = "Possessions") + 
  theme(legend.position = "none")
```

Here we have a data visualization of the possessions by teams. Each of the colored dashed lines is the possessions for each team over the years. The dashed black line represents the average possessions for each season, and is the same in each facet. The solid black line represents the average possessions for each team, and is different in each facet.

-----

## Key Notes: Possession

- a steady increase over time
- dips observed
  - 1998 and 2011- contract negotiations
  - 2019 and 2020- less games played due to COVID-19

-----

![](slide22.PNG?raw=true)

This visualization created using Tableau, shows the playstyles ranked from seasons 2015 to 2020. We see that the playstyles: spot up, ball handler, transition, and cut are ranked highly and their ranks did not change much. We can see that the dynamic playstyles are becoming more popular than non-dynamic playstyles, such as post up, isolation, roll man, and putbacks.

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Get the data------------------------------------------------------------------
# Since there are 5 sheets within each file, save each sheet as its own table
injuries <- read_excel_allsheets("NBA_Injuries_Team.xlsx")
injury2016 <- injuries[[1]]
injury2017 <- injuries[[2]]
injury2018 <- injuries[[3]]
injury2019 <- injuries[[4]]
injury2020 <- injuries[[5]]
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Initial manipulation and joining----------------------------------------------
# Sort each of the tables by Team
injury2016 <- injury2016 %>%
  arrange(Team) %>%
  mutate(Season = rep(2016,30))
injury2017 <- injury2017 %>%
  arrange(Team) %>%
  mutate(Season = rep(2017,30))
injury2018 <- injury2018 %>%
  arrange(Team) %>%
  mutate(Season = rep(2018,30))
injury2019 <- injury2019 %>%
  arrange(Team) %>%
  mutate(Season = rep(2019,30))
injury2020 <- injury2020 %>%
  arrange(Team) %>%
  mutate(Season = rep(2020,30))

# Join all the data tables together to make it into long data
injury_long1 <- rbind(injury2016, injury2017, injury2018, injury2019, injury2020)

# Save injury cash earned data with only season average
injury_long2 <- injury_long1 %>%
  group_by(Season) %>%
  summarize(Team = Team,
            Players = Players,
            Games = Games,
            Earned_While_Injured = Earned_While_Injured,
            Season = Season,
            Season_Average_Earnings = mean(Earned_While_Injured)) %>%
  ungroup()
injury_long3 <- injury_long1 %>%
  group_by(Season) %>%
  summarize(Season_Average_Earnings = mean(Earned_While_Injured)) %>%
  ungroup()

# Create data frame to print season average on each facet
average_cash <- data.frame(
  variable = unique(injury_long3$Season),
  value = injury_long3$Season_Average_Earnings,
  Team = rep(unique(injury_long1$Team), each = 5))
average_cash_teams <- injury_long1 %>%
  group_by(Team) %>%
  arrange(Team) %>%
  mutate(team_avg = mean(Earned_While_Injured, na.rm = TRUE)) %>%
  ungroup()

# Convert Season into integer
injury_long1$Season <- as.integer(injury_long1$Season)
injury_long2$Season <- as.integer(injury_long2$Season)
injury_long3$Season <- as.integer(injury_long3$Season)
```

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(injury_long1, aes(x = Earned_While_Injured, y = Team, color = Team)) + 
  geom_boxplot() + 
  labs(title = 'NBA Seasons 2016-17 to 2020-21 Cash Earned While Injured By Teams',
       x = "Cash Earned While Injured (US$)",
       y = "Team") + 
  theme_light() + 
  theme(legend.position = "none") + 
  scale_x_continuous(breaks = c(0, 25000000, 50000000, 75000000),
                     labels = c(dollar(0), dollar(25000000), dollar(50000000), dollar(75000000)))
```

This is a side-by-side box-and-whisker plot, or a box plot of the cash earned while injured by teams for seasons 2016-17 to 2020-21. Each of the box plots contains 5 important values: the minimum, first quartile, median or second quartile, third quartile, and maximum. The rectangle displays the interquartile range (IQR), and lone points are outliers.

From this visualization, we can see that Brooklyn Nets has the highest median cash earned while injured. This may be because more injuries caused more money to be lost. Brooklyn Nets also has a very large outlier. We also observe that Detroit Pistons has the lowest median cash earned while injured. This may be because the team didn't lose as much money as other teams because they had less injuries. We can also see that Golden State Warriors has the biggest IQR, and Utah Jazz has the smallest IQR. It seems like teams are losing a lot of money because of injuries.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(injury_long1, aes(x = Season, y = Earned_While_Injured, group = Team, color = Team)) + 
  geom_line(linetype = "dashed") + 
  geom_line(data = injury_long2, aes(x = Season, y = Season_Average_Earnings), color = "black") + 
  geom_point(data = injury_long2, aes(x = Season, y = Season_Average_Earnings), color = "black") +
  theme_light() + 
  labs(title = "NBA Seasons 2016-17 to 2020-21 Cash Earned While Injured By Teams",
       x = "Season",
       y = "Cash Earned While Injured (US$)") +
  scale_y_continuous(breaks = c(0, 25000000, 50000000, 75000000),
                     labels = c(dollar(0), dollar(25000000), dollar(50000000), dollar(75000000))) + 
  theme(legend.position = "bottom")
```

The cash earned while injured by teams is visualized above. Each of the colored dashed lines represents the cash earned while injured for each team for seasons 2016-17 to 2020-21. The black solid line represents the average cash earned while injured of all teams for each season.

From the visualization, we see an increase in cash earned while injured over time.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(injury_long1, aes(x = Season, y = Earned_While_Injured, group = Team, color = Team)) + 
  geom_line() + 
  facet_wrap(~Team) + 
  geom_line(data = average_cash, aes(x = variable, y = value), color = "black", linetype = "dashed") + 
  geom_line(data = average_cash_teams, aes(x = Season, y = team_avg), color = "black") + 
  theme_light() + 
  labs(title = "NBA Seasons 2016-17 to 2020-21 Cash Earned While Injured By Teams",
       x = "Season",
       y = "Cash Earned While Injured (US$)") + 
  scale_y_continuous(breaks = c(0, 25000000, 50000000, 75000000),
                     labels = c(dollar(0), dollar(25000000), dollar(50000000), dollar(75000000))) + 
  theme(legend.position = "none")
```

Now, let's take a closer look at the cash earned while injured by teams. Each of the colored dashed lines is the cash earned while injured for each team over the years. The dashed black line represents the average cash earned while injured for each season, and is the same in each facet. The solid black line represents the average cash earned while injured for each team, and is different in each facet.

From the visualization, we can see that even though it is not apparent for every team, some teams, like Brooklyn Nets and Golden State Warriors, see an increase in cash earned while injured.

-----

## Key Notes: Cash earned while injured

- an increase in average cash earned while injured
- Brooklyn Nets have the highest median cash earned while injured
- Detroit Pistons have the lowest median cash earned while injured
- teams are losing a lot of money because of injuries

-----

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Get the data------------------------------------------------------------------
# Speed data set
speed_long <- read_excel("speed_long.xlsx")
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Initial manipulation and joining----------------------------------------------
speed_long1 <- speed_long %>%
  select(Team, Avg_Speed, Season)

speed_team2013 <- speed_long1 %>%
  filter(Season == 2013) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2013")

speed_team2014 <- speed_long1 %>%
  filter(Season == 2014) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2014")

speed_team2015 <- speed_long1 %>%
  filter(Season == 2015) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2015")

speed_team2016 <- speed_long1 %>%
  filter(Season == 2016) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2016")

speed_team2017 <- speed_long1 %>%
  filter(Season == 2017) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2017")

speed_team2018 <- speed_long1 %>%
  filter(Season == 2018) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2018")

speed_team2019 <- speed_long1 %>%
  filter(Season == 2019) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2019")

speed_team2020 <- speed_long1 %>%
  filter(Season == 2020) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2020")

speed_long2 <- rbind(speed_team2013, speed_team2014, speed_team2015, speed_team2016, speed_team2017, speed_team2018, speed_team2019, speed_team2020)

speed_long2$Season <- as.integer(speed_long2$Season)

speed_long3 <- speed_long1 %>%
  group_by(Season) %>%
  summarize(Season_Avg_Speed = mean(Avg_Speed, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Team = "Season Average")

# Create data frame to print season average on each facet
average_speed <- data.frame(
  variable = unique(speed_long3$Season),
  value = speed_long3$Season_Avg_Speed,
  Team = rep(unique(speed_long2$Team), each = 8))
```

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(speed_long2, aes(x = Season, y = Team_Avg_Speed, group = Team, color = Team)) + 
  geom_line(linetype = "dashed") + 
  geom_line(data = speed_long3, aes(x = Season, y = Season_Avg_Speed), color = "black") + 
  geom_point(data = speed_long3, aes(x = Season, y = Season_Avg_Speed), color = "black") +
  theme_light() + 
  labs(title = "NBA Seasons 2016-17 to 2020-21 Average Speed By Teams",
       x = "Season",
       y = "Speed") +
  theme(legend.position = "bottom")
```

The average speed by teams is visualized above. Each of the colored dashed lines represents the average speed for each team for seasons 2016-17 to 2020-21. The black solid line represents the average speed of all teams for each season.

From the visualization, we see the average speed of Cleveland Cavaliers dropped in 2018 and 2019. That may be because NBA tracked one player who only played one game, and that player's speed made the team's average drop. Also, speed is not tracked for every game and every player, so team averages will be skewed. Though not big, we do see a slight increase in average speed over time.

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Get the data------------------------------------------------------------------
# Distance data set
dist_long <- read_excel("speed_long.xlsx")
```

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Initial manipulation and joining----------------------------------------------
dist_long1 <- dist_long %>%
  select(Team, Dist_Miles, Season)

dist_team2013 <- dist_long1 %>%
  filter(Season == 2013) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2013")

dist_team2014 <- dist_long1 %>%
  filter(Season == 2014) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2014")

dist_team2015 <- dist_long1 %>%
  filter(Season == 2015) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2015")

dist_team2016 <- dist_long1 %>%
  filter(Season == 2016) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2016")

dist_team2017 <- dist_long1 %>%
  filter(Season == 2017) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2017")

dist_team2018 <- dist_long1 %>%
  filter(Season == 2018) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2018")

dist_team2019 <- dist_long1 %>%
  filter(Season == 2019) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2019")

dist_team2020 <- dist_long1 %>%
  filter(Season == 2020) %>%
  group_by(Team) %>%
  summarize(Team_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Season = "2020")

dist_long2 <- rbind(dist_team2013, dist_team2014, dist_team2015, dist_team2016, dist_team2017, dist_team2018, dist_team2019, dist_team2020)

dist_long2$Season <- as.integer(dist_long2$Season)

dist_long3 <-dist_long1 %>%
  group_by(Season) %>%
  summarize(Season_Avg_Dist = mean(Dist_Miles, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(Team = "Season Average")

# Create data frame to print season average on each facet
average_dist <- data.frame(
  variable = unique(dist_long3$Season),
  value = dist_long3$Season_Avg_Dist,
  Team = rep(unique(dist_long2$Team), each = 8))
```

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggplot(dist_long2, aes(x = Season, y = Team_Avg_Dist, group = Team, color = Team)) + 
  geom_line(linetype = "dashed") + 
  geom_line(data = dist_long3, aes(x = Season, y = Season_Avg_Dist), color = "black") + 
  geom_point(data = dist_long3, aes(x = Season, y = Season_Avg_Dist), color = "black") +
  theme_light() + 
  labs(title = "NBA Seasons 2016-17 to 2020-21 Average Distance By Teams",
       x = "Season",
       y = "Distance (miles)") +
  theme(legend.position = "bottom")
```

The average distance by teams is visualized above. Each of the colored dashed lines represents the average distance for each team for seasons 2016-17 to 2020-21. The black solid line represents the average speed of all teams for each season.

From the visualization, we can see a slight increase in average distance by teams over time. Also, distance is not tracked for every game and every player, so team averages will be skewed.

-----

## Key Notes: Speed and Distance

- players have more mileage
- the distance in games have increased
  - speed and distance is missing for some players and games
  - numbers can be skewed because of players that have played small minutes
- comparing 2013 to 2020, speed is higher in 2020
  - peaked in 2017, though downtrending, it looks likt it's making its way back up

-----

```{r, echo = TRUE, include = FALSE, results = FALSE, warning = FALSE, message = FALSE}
# Initial manipulation and joining----------------------------------------------
# Convert Season into integer
pace_long1$Season <- as.integer(pace_long1$Season)
poss_long1$Season <- as.integer(poss_long1$Season)

# Convert Dist_Feet into numeric
speed_long$Dist_Feet <- as.numeric(speed_long$Dist_Feet)

# Filter out the years for speed
speed_long1 <- speed_long %>%
  filter(Season > 2015) %>%
  group_by(Team, Season) %>%
  summarize(Team_Avg_Speed = mean(Avg_Speed, na.rm = TRUE),
            Team_Avg_Dist_Feet = mean(Dist_Feet, na.rm = TRUE)) %>%
  ungroup()

# Join the pace, possessions, speed, and injury data frames
df <- pace_long1 %>%
  left_join(poss_long1, by = c("Season" = "Season", "Team" = "Team")) %>%
  filter(Season > 2015) %>%
  left_join(injury_long1, by = c("Season" = "Season", "Team" = "Team")) %>%
  rename(Number_of_Injured_Players = Players,
         Number_of_Games_Missed = Games,
         Cash_Earned_While_Injured = Earned_While_Injured) %>%
  left_join(speed_long1, by = c("Season" = "Season", "Team" = "Team"))

# Create data frames for each of the years
df2016 <- df %>%
  filter(Season == 2016)
df2017 <- df %>%
  filter(Season == 2017)
df2018 <- df %>%
  filter(Season == 2018)
df2019 <- df %>%
  filter(Season == 2019)
df2020 <- df %>%
  filter(Season == 2020)
```

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df, columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Seasons 2016-17 to 2020-21",
        lower = list(continuous = "smooth"))
```

The visualization above is a pair plot. The variable names are displayed on the outer edges of the matrix. The scatter plot in the lower triangle shows the relationship between two variables. In the scatter plot, we have a loess smoother to help us see the relationship between two variables and foresee trends. The boxes along the diagonal display the density plot for each variable. A density plot helps us visualize the distribution of the data. The boxes in the upper right corner display the Pearson correlation coefficient between two variables. The Pearson correlation, or r, gives us the magnitude and direction of the linear relationship between two variables and has a value between -1 and +1. The higher the absolute value of r, the stronger the correlation. -1 signifies a perfect negative linear correlation. 0 signifies no linear relationship between the two variables. +1 signifies a perfect positive linear correlation. There are other types of correlation; however, they were not used: Spearman and Kendall.

Looking at the scatter plot and loess smoother, the number of games missed and earned while injured displays a clear positive relationship. There is also a clear positive relationship between the number of injured players and number of games missed. There is a slight positive linear relationship between pace and number of injured players, pace and earned while injured, pace and average distance, possessions and average speed, and number of injured players and earned while injured.

Looking at the density plot for possessions, we observe two peaks, which means it is bimodal. This may be caused by looking at all the teams and all the seasons at once. For number of games missed and earned while injured, it looks like they are right skewed, which means that the mean is greater than the median. For average speed, it looks like it is left skewed, which means that the mean is less than the median.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Seasons 2016-17 to 2020-21")
```

Here, we have a correlogram, or a correlation visualization. Specifically, this is a correlation matrix. A correlation matrix is used to analyze the correlation between multiple variables at the same time. It is useful to highlight the most correlated variables in a data table. In this plot, correlation coefficients are colored according to the value, displayed as a lower triangular matrix. Significance codes are displayed next to the Pearson correlation to represent if the variables are statistically significant. A p-value less than or equal to 0.05 is statistically significant. That means that there is an attributable cause for the two variables to be correlated, and not because of chance.

From this correlation matrix, we can see a statistically significant linear relationship between number of injured players and pace, earned while injured and pace, average distance and pace, average speed and possessions, number of games missed and number of injured players, earned while injured and number of injured players, and earned while injured and number of games missed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df2016,
        columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Season 2016-17",
        lower = list(continuous = "smooth"))
```

We have a pair plot for season 2016-17. Looking at the scatter plot and loess smoother, pace and possessions, pace and number of injured players, number of injured players and number of games missed, and number of games missed and earned while injured have a clear positive linear relationship. Looking at the density plot, the distribution of average distance seems to be right skewed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df2016[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Season 2016-17")
```

From this correlation matrix, we can see a statistically significant linear relationship between possessions and pace, number of injured players and pace, number of games missed and number of injured players, and earned while injured and number of games missed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df2017,
        columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Season 2017-18",
        lower = list(continuous = "smooth"))
```

Here, we have a pair plot for season 2017-18. Looking at the scatter plot and loess smoother, pace and possessions, number of injured players and number of games missed, number of injured players and earned while injured, and number of games missed and earned while injured have a clear positive linear relationship.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df2017[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Season 2017-18")
```

From this correlation matrix, we can see a statistically significant linear relationship between possessions and pace, number of games missed and number of injured players, earned while injured and number of injured players, and earned while injured and number of games missed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df2018,
        columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Season 2018-19",
        lower = list(continuous = "smooth"))
```

Here, we have a pair plot for season 2018-19. Looking at the scatter plot and loess smoother, pace and possessions, pace and average speed, number of injured players and number of games missed, number of injured players and earned while injured, and number of games missed and earned while injured have a clear positive linear relationship.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df2018[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Season 2018-19")
```

From this correlation matrix, we can see a statistically significant linear relationship between possessions and pace, average speed and pace, number of games missed and number of injured players, earned while injured and number of injured players, and earned while injured and number of games missed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df2019,
        columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Season 2019-20",
        lower = list(continuous = "smooth"))
```

Here, we have a pair plot for season 2019-20. Looking at the scatter plot and loess smoother, number of injured players and number of games missed, number of games missed and earned while injured, and average speed and average distance have a clear positive linear relationship.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df2019[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Season 2019-20")
```

From this correlation matrix, we can see a statistically significant linear relationship between number of games missed and number of injured players, earned while injured and number of games missed, and average distance and average speed.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
ggpairs(df2020,
        columns = 3:9,
        columnLabels = c('Pace', 'Possessions', 'No. of Injured Players', 
                         'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        title = "NBA Season 2020-21",
        lower = list(continuous = "smooth"))
```

Here, we have a pair plot for season 2020-21. Looking at the scatter plot and loess smoother, pace and possessions, pace and average speed, and number of games missed and earned while injured have a clear positive linear relationship. Possessions and number of injured, number of injured players and average speed, and number of injured players and average distance have a clear negative linear relationship.

```{r, fig.width = 15, fig.height = 8, echo = FALSE, results = FALSE, warning = FALSE, message = FALSE}
corPlot(df2020[,3:9],
        scale = FALSE,
        stars = TRUE,
        upper = FALSE,
        labels = c('Pace', 'Possessions', 'No. of Injured Players', 
                   'No. Games Missed', 'Earned While Injured', 
                         'Avg Speed', 'Avg Distance (ft)'),
        main = "NBA Season 2020-21")
```

From this correlation matrix, we can see a statistically significant linear relationship between possessions and pace, average speed and pace, number of injured players and possessions, average speed and number of injured players, average distance and number of injured players, and earned while injured and number of games missed.

-----

## Key Notes: Correlation

- **number of games missed** and **earned while injured** have a ***strong*** positive linear relationship
- **pace** and **possessions** have a positive linear relationship
- **number of games missed** and **number of injured players** have a positive linear relationship
- **earned while injured** and **number of injured players** have a positive linear relationship

-----

![](slide43.PNG?raw=true)

From this visualization that was created using Tableau, we can see that the higher the pace, the more likely the team wins the championship. We can see that from 2017 to 2020, all the teams with higher pace won the championship, except in 2016, where the team with lower pace won.

![](slide44.PNG?raw=true)

Similarly in this visualization, we can see that the fewer number of games missed due to injuries, the more likely the team wins the championship. We can see that from 2016 to 2019, all the teams with less games missed won the championship, except in 2020, where the team with more games missed won. That might be because Miami Heat's pace was less than Los Angeles Lakers.

-----

## Key Notes: Championships

- champions seem to either have a faster pace or less injuries
- **insight**: the higher the pace, the more likely the team wins the championship
- **insight**: the fewer the number of games missed, the more likely they win the championship
- though not sole factor, tempo and team health plays a role in winning a championship

----------

# **Conclusion**

## Observations

- pace, possessions, speed, distance, and cash earned while injured increased over time
- high correlation between number of games missed and cash earned while injured
- dynamic plays steadily became more popular as compared to non-dynamic plays
- champion teams between seasons 2016-17 to 2020-21 tended to have the advantage in either pace or health

-----

## Insights

- contract negotiations and pandemic/health concerns led to a decrease in team possessions in 1998, 2011, 2019, and 2020
- the more injured players, the higher the number of games missed due to injuries, the more money the team loses
- the higher the pace and the fewer the number of games missed due to injuries, the more likely the team wins the championship

-----

## Recommendations

- healthy players = less likely to suffer from injuries
  - pre-season physical examinations
  - athletic coach/trainer/specialist services to maintain proper fitness
  - proper stretching before going to play
  - adequate amount of time off and breaks to rest
  - physical therapy and post-injury treatment services
- wear well-fitted, basketball gear and equipment

-----

## Shortcomings

- some data sets are incomplete
  - average speed and distance were not tracked for all players and games
  - NBA playstyles data only goes back to season 2015-16
- some data is skewed
- playstyles can be utilized in different speeds
- teams play differently during playoffs
  - our study only looked at statistics of regular seasons
  
-----

## Results and Lessons Learned

- generally faster paced games lead to more injuries and win towards the championships
- deciding what metrics to include
- finding ways to display the data
- what or what not to include

-----

## Next Steps

- smaller range of seasons
- specific playstyles
- specific teams
- dive deeper into the data by analyzing player data

----------

# **Sources**

- [NBA Advanced Stats](https://www.nba.com/stats/)
- [spotrac | Cumulative Season Injured List By Player](https://www.spotrac.com/nba/injured-reserve/)
- [ESPN | Data shows NBA injuries up in condensed season](https://www.espn.com/nba/story/_/id/31592404/data-shows-nba-injuries-condensed-season)
- [Sportico | NBA Playoff Injury Rash Extends Real Multi-Year Trend: Data Viz](https://www.sportico.com/leagues/basketball/2021/nba-playoffs-injuries-data-viz-1234633741/)
- [Bleacher Report | Inside the Psyche of an Injured NBA Superstar](https://bleacherreport.com/articles/1515597-inside-the-psyche-of-an-injured-nba-superstar)
- [Fansided | The Whiteboard: Injuries will impact NBA Playoffs more than ever](https://fansided.com/2021/05/05/whiteboard-injuries-may-determine-nba-title-race-ever/)
- [ESPN | NBA extends its disability insurance three more years](http://www.espn.com/sportsbusiness/s/2003/0311/1521986.html#:~:text=Disability%20insurance%20kicks%20in%20after,play%20in%2041%20consecutive%20games.)
- [The Sporting News | NBA Playoffs 2021: Brooklyn Nets suffer another injury setback in Game 4 loss](https://www.sportingnews.com/in/nba/news/nba-playoffs-2021-brooklyn-nets-suffer-another-injury-setback-in-game-4-loss-kyrie-irving/z8bq0xg4db881fpyxf7rfdnqk)
- [Hack a Stat | Learn a Stat: Possessions and Pace](https://hackastat.eu/en/learn-a-stat-possessions-and-pace/#:~:text=The%20answer%20is%20no%3B%20Pace%20%28and%20possessions%29%20are,League%20Pace%20is%20around%2074%20possessions%20per%20game.)
- [University of Rochester Medical Center | Orthopaedics & Physical Performance: Sports Medicine: Basketball Injuries](https://www.urmc.rochester.edu/orthopaedics/sports-medicine/basketball-injuries.cfm)